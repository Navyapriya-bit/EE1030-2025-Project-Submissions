import os
import numpy as np
from PIL import Image
import matplotlib.pyplot as plt

file_path = "/home/navya/Downloads/SoftwareAssignment/codes/python_driver/greyscale/greyscale.jpg"
grayscale = Image.open(file_path).convert('L')  # ensure grayscale

plt.figure(figsize=(12,6))
plt.imshow(grayscale)
plt.title('Original image')

file_size = os.path.getsize(file_path)
print(f"Size: {np.round(file_size/1024)} KB")
print(f"Shape: {np.array(grayscale).shape}")

grayscale_gray = np.array(grayscale, dtype=np.uint8)  # ensure 2D array
print(f"Shape of Grayscale grayscale: {np.shape(grayscale_gray)}")

plt.figure(figsize=(12,6))
plt.imshow(grayscale_gray, cmap='gray')
plt.title('Grayscale image')

file_path_gray = "/home/navya/Downloads/SoftwareAssignment/codes/python_driver/greyscale/gray_grayscale.jpg"
Image.fromarray(grayscale_gray).save(file_path_gray)
file_size_grayscale_gray = os.path.getsize(file_path_gray)
print(f"Size grayscale grayscale: {np.round(file_size_grayscale_gray/1024)}KB")

plt.show()

U, s, Vt = np.linalg.svd(grayscale_gray, full_matrices=False)
print(f'U = {np.shape(U)}')
print(f's = {np.shape(s)}')
print(f'V = {np.shape(Vt)}')

S = np.diag(s)
grey_reconstructed_3_s = U @ S @ Vt

plt.figure(figsize=(18,10))
plt.subplot(2,3,5)
plt.title('grey_reconstructed_3_s', fontsize=18)
plt.imshow(grey_reconstructed_3_s, cmap='gray')
plt.axis('off')
plt.tight_layout()
plt.show()

plt.figure(figsize=(12,6))
plt.plot(s, 'ro', markerfacecolor='w')
plt.title('Singular Values')
plt.show()

S_k = np.zeros((np.shape(U)[1], np.shape(Vt)[0]))
no_k = 5

for i in range(no_k):
    S_k[i,i] = s[i]

grey_reconstructed_3_s = np.clip(U @ S_k @ Vt, 0, 255).astype(np.uint8)

file_path_grey_reconstructed_3_s = "/home/navya/Downloads/SoftwareAssignment/codes/python_driver/greyscale/grey_reconstructed_3_s.jpg"
Image.fromarray(grey_reconstructed_3_s).save(file_path_grey_reconstructed_3_s)
file_size_grey_reconstructed_3_s = os.path.getsize(file_path_grey_reconstructed_3_s)
print(f"size gray reconstructed: {np.round(file_size_grey_reconstructed_3_s/1024)}KB")

grayscale_grayscale = Image.open(file_path_gray)
plt.figure(figsize=(15,8))

plt.subplot(1,2,1)
plt.imshow(grayscale_grayscale, cmap='gray')
plt.title('Original Grayscale')

plt.subplot(1,2,2)
plt.imshow(grey_reconstructed_3_s, cmap='gray')
plt.title('Reconstructed image')

plt.show()

