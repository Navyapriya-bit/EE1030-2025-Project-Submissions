
import os
import numpy as np
from PIL import Image
import matplotlib.pyplot as plt


# Load the image using the full path
file_path = "/home/navya/Downloads/SoftwareAssignment/codes/python_driver/greyscale/greyscale.jpg"
grayscale = Image.open(file_path).convert('L') 

plt.figure(figsize=(12,6))
plt.imshow(grayscale)
plt.title('Original image')

# Get file size and shape
file_size = os.path.getsize(file_path)
print(f"Size: {np.round(file_size/1024)} KB")
print(f"Shape: {np.array(grayscale).shape}")

grayscale_array = np.array(grayscale, dtype = np.uint8)
 
# converting to grayscale
grayscale_gray = np.array(grayscale, dtype=np.uint8)   # fixed grayscale conversion
print(f"Shape of Grayscale grayscale: {np.shape(grayscale_gray)}")

# Displaying grayscale image
plt.figure(figsize=(12,6))
plt.imshow(grayscale_gray, cmap='gray')
plt.title('Grayscale image')

#Saving the grayscale image
file_path_gray = "/home/navya/Downloads/SoftwareAssignment/codes/python_driver/greyscale/gray_grayscale.jpg"
Image.fromarray(grayscale_gray).save(file_path_gray)
file_size_grayscale_gray = os.path.getsize(file_path_gray)
print(f"Size grayscale grayscale: {np.round(file_size_grayscale_gray/1024)}KB")

plt.show()

# SVD
U, s, Vt = np.linalg.svd(grayscale_gray, full_matrices=False)
print(f'U = {np.shape(U)}')
print(f's = {np.shape(s)}')
print(f'V = {np.shape(Vt)}')

S = np.diag(s)
grey_reconstructed_1_s = U @ S @ Vt

# Visualizing
plt.figure(figsize=(18,10))

plt.subplot(2,3,4)
plt.title('Original Gray scale', fontsize=18)
plt.imshow(U, cmap='coolwarm')

plt.subplot(2,3,1)
plt.title('U', fontsize=18)
plt.imshow(U, cmap='coolwarm')

plt.subplot(2,3,2)
plt.title('$\\Sigma$', fontsize=18)
plt.imshow(S, cmap='coolwarm')

plt.subplot(2,3,5)
plt.title('grey_reconstructed_1_s', fontsize=18)
plt.imshow(grey_reconstructed_1_s, cmap='gray')
plt.axis('off')

plt.tight_layout()
plt.show()

# plot singular values
plt.figure(figsize=(12,6))
plt.subplot(1,2,1)
plt.plot(s, 'ro', markerfacecolor='w')
plt.title('Singular Values')

plt.show()

S_k = np.zeros((np.shape(U)[1], np.shape(Vt)[0]))
no_k = 5

for i in range(no_k):
    S_k[i,i] = s[i]

grey_reconstructed_1_s = np.clip(U @ S_k @ Vt, 0, 255).astype(np.uint8)

# saving reconstructed image
file_path_grey_reconstructed_1_s = "/home/navya/Downloads/SoftwareAssignment/codes/python_driver/greyscale/grey_reconstructed_1_s.jpg"
Image.fromarray(grey_reconstructed_1_s).save(file_path_grey_reconstructed_1_s)
file_size_grey_reconstructed_1_s = os.path.getsize(file_path_grey_reconstructed_1_s)
print(f"size gray reconstructed: {np.round(file_size_grey_reconstructed_1_s/1024)}KB")
print(f"size grayscale grayscale: {np.round(file_size_grayscale_gray/1024)}KB")

# display grayscale and reconstructed side by side
grayscale_grayscale = Image.open(file_path_gray)
plt.figure(figsize=(15,8))

plt.subplot(1,2,1)
plt.imshow(grayscale_grayscale, cmap='gray')
plt.title('Original Grayscale')

plt.subplot(1,2,2)
plt.imshow(grey_reconstructed_1_s, cmap='gray')
plt.title('Reconstructed image')

plt.show()
plt.subplot(1,2,1)
plt.imshow(grayscale_grayscale, cmap='gray')
plt.title('Original Grayscale')

plt.subplot(1,2,2)
plt.imshow(grey_reconstructed_1_s, cmap='gray')
plt.title('Reconstructed image')

plt.show()
